---
title: RLDP与DLDP协议详解
description: 详细介绍锐捷RLDP防环协议和DLDP数据链路检测协议的工作原理、配置命令及典型应用场景，包含环路检测、单向/双向链路检测等关键技术。
tags: [网络可靠性, RLDP, DLDP, 链路检测, 锐捷协议]
date: 2023-12-04T21:27:21Z
lastmod: 2024-05-02T13:52:37Z
---
## 可靠性

### RLDP 防环协议

　　**锐捷私有**

　　RLDP 定义了两种协议报文:探测报文(Probe)和探测响应报文(Echo),报文目的地址为 2 层组播地址(01-d0-f8.00-00-02)

　　RLDP 会在每个配置了 RLDP 并且是 linkup 的端口周期性地发送本端口的 Probe 报文，并期待邻居端口响应该探测报文，同时也期待邻居端口也发送自己的 Probe 报文。如果一条链路在物理和逻辑上都是正确的，那么一个端口应该能收到邻居端口的探测响应报文以及邻居端口的探测报文。否则链路将被认定是异常的。

　　锐捷 RLDP 协议定义 3 种功能，分别为:**环路检测、单向链路检测、双向链路检测。**

　　RLDP 功能主要是应用到接入层交换机上做环路检测用(汇聚层也可以开 RLDP 防环，但是控制防范的粒度比较粗糙)，特别适用于交换机下联 HUB 自身打环的情况(STP 无法实现防止这类的环路)

　　注意：单向和双向链路检测需要两端设备都开启该协议

* 单向链路故障是指端口连接的链路只能接收报文或者只能发送报文(比如由于光纤接收线对接错误导致的单向接收或单向发送)。如下图所示，RLDP 在某个端口上只收到邻居端口的探测报文则该端口将被认为单向链路故障，于是 RLDP 会根据用户的配置对这种故障做出处理，
* 双向链路故障是指链路两端的帧在收发方向都出现了故障。如下图所示，设备的端口在发出 RLDP 探测报文后就一直无法接收到响应报文或邻居的探测报文，那么该链路将被认为是双向故障的。

　　只能在二层口配置

　　‍

```shell
rldp ena  // 全局开启协议
int gi0/24
rldp port unidirection-detect shutdown-port // 单向链路检测，动作 关闭端口
rldp port bidirection-detect shutdown-port  // 双向链路检测，动作 关闭端口
rldp port loop-detect shutdown-port // 环路检测，动作 关闭端口
errdisable recovery interval 300  // 全局下配置恢复时间

rldp detect-interval 3  // 修改探测间隔 默认3s，可选2-15s
rldp detect-max 2 // RLDP最大探测次数。打开了RLDP功能的端口如果在最大探测期(最大探测次数*探测间隔)内仍然无法接收到邻居的报文，则该端口将被诊断为故障(默认2次，取值范围2-10次)
rldp reset  // 立即恢复端口状态
```

### DLDP 数据链路检测

　　DLDP 英文全称为(data link detection protocol)，中文名称为数据链路检测协议。

　　DLDP 技术利用 ICMP 协议检测到对端的可达性来进行连通性检测，从而提供了一种在以太链路上的探测机制。当检测失败时会将该接口的 Protocol 状态置为 Down，从而和接口状态相关联的模块状态会随之发生改变，达到快速切换的目的。

　　**工作流程：**

1. 初始化阶段:

   当在接口启动 DLDP 功能时，DLDP 协议转为初始化状态，接着会发送 arp 请求，期待获取到对端设备的 mac 地址。
   如果一直获取不到就会一直处于初始化阶段，当获取到对端的 mac 地址后，转为链路成功状态。

   注:由于广域网接口所封装的协议，如 ppp、frame-relay、E1 等本身自带链路检测机制,因此广域网接口不支持 DLDP 功能
2. 链路成功状态:

   在本状态下，就可以发出 DLDP 链路探测请求报文进行连通性的检测。收到 DLDP 回应报文则标记该接口为 UP 状态如果没有接收到回应报文，则继续发送请求报文，直到超过最大探测次数，标记链路失败，状态转为初始化状态.
3. 删除状态:

   删除状态下(即取消该配置)，接口的状态不再由链路探测功能进行分析，其状态和物理通道的状态保持一致。
   在任意状态下，只要删除了接口的 DLDP 配置，则直接进入删除状态。

　　**锐捷**

```shell
dldp 192.168.1.1 [hext hoo ip] interval 100 resume 2  // 
// 192.168.1.1  目的地址
// [hext hoo ip]  下一跳，跨网段时需要配置
// 100 每1s发送一次icmp报文
// 2 恢复时间：检测周期 * 2
```
