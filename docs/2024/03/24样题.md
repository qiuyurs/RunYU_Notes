---
title: ä¿¡æ¯æŠ€æœ¯åº”ç”¨åˆ›æ–°24æ²³åŒ—çœèµ›æ ·é¢˜è§£æ
description: 2024å¹´æ²³åŒ—çœèŒä¸šé™¢æ ¡æŠ€èƒ½å¤§èµ›é«˜èŒç»„ä¿¡æ¯æŠ€æœ¯åº”ç”¨åˆ›æ–°èµ›é¡¹æ ·é¢˜ï¼ŒåŒ…å«æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ç¯å¢ƒé…ç½®ã€ç½‘ç»œæœåŠ¡éƒ¨ç½²ç­‰å…³é”®æŠ€æœ¯ç‚¹
tags: [ä¿¡æ¯æŠ€æœ¯åº”ç”¨åˆ›æ–°, æŠ€èƒ½å¤§èµ›, ç½‘ç»œæœåŠ¡, éº’éºŸç³»ç»Ÿ, æœåŠ¡å™¨é…ç½®]
date: 2024-05-14T21:06:32Z
lastmod: 2024-10-29T20:56:30Z
---

# 24æ ·é¢˜

# **2024å¹´æ²³åŒ—çœèŒä¸šé™¢æ ¡æŠ€èƒ½å¤§èµ›**

#  **â€œä¿¡æ¯æŠ€æœ¯åº”ç”¨åˆ›æ–°èµ›é¡¹â€ï¼ˆé«˜èŒç»„ï¼‰æ ·é¢˜**

## **ä¸€ã€åˆå§‹åŒ–ç¯å¢ƒ**

ã€€ã€€	1.è´¦å·åŠé»˜è®¤å¯†ç å¦‚è¡¨1æ‰€ç¤ºã€‚

ã€€ã€€è¡¨1 è´¦å·åŠå¯†ç è§„åˆ’è¡¨

|è´¦ å·|å¯† ç |
| ----------------| ------------|
|rootï¼ˆæœåŠ¡ç«¯ï¼‰|kylin2024!|
|deskï¼ˆå®¢æˆ·ç«¯ï¼‰|kylin2024!|

ã€€ã€€	2.æ“ä½œç³»ç»Ÿé…ç½®å¦‚è¡¨2æ‰€ç¤ºã€‚

ã€€ã€€è¡¨2 æ¡Œé¢åŠæœåŠ¡å™¨æ“ä½œç³»ç»Ÿé…ç½®è¡¨

|ç‰ˆæœ¬|æ—¶åŒº|ç³»ç»Ÿç¯å¢ƒè¯­è¨€|é”®ç›˜|
| -------------------------------------| ---------------| --------------------| ------------|
|Kylin-Server-10-SP2ï¼ˆæœåŠ¡å™¨ï¼‰|Asia/Shanghai|English US (UTF-8)|English US|
|Kylin-Desktop-V10-SP1ï¼ˆæ¡Œé¢å®¢æˆ·ç«¯ï¼‰|Asia/Shanghai|English US (UTF-8)|English US|

ã€€ã€€3.æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŸºæœ¬é…ç½®å¦‚è¡¨3æ‰€ç¤ºã€‚

ã€€ã€€è¡¨3 æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŸºæœ¬é…ç½®è¡¨

|è®¾å¤‡|ä¸»æœºå|IPåœ°å€|æœåŠ¡|å®‰å…¨çŠ¶æ€|
| --------| ----------------------| --------------------------------| ----------------------------------------| --------------------------------|
|æœåŠ¡ç«¯|server.kylin2024.com|é™æ€IPåœ°å€ï¼š192.168.100.100/24|FTPISCSICHRONYDNSNFSDOCKERMARIADBNGINX|Selinux=disabledKysec=disabled|
|å®¢æˆ·ç«¯|client.kylin2024.com|é™æ€IPåœ°å€ï¼š192.168.100.101/24|ISCSINFSAnsibleCHRONY|Selinux=disabledkysec=enabled|

## **äºŒã€ä»»åŠ¡æè¿°**

ã€€ã€€	ä¸ºäº†ä¿ƒè¿›ä¿¡åˆ›äº§ä¸šçš„å‘å±•ï¼ŒåŒæ—¶ä¸ºå‘˜å·¥æä¾›ä¾¿æ·ã€ç¨³å®šã€å®‰å…¨çš„å†…å¤–ç½‘ç½‘ç»œç¯å¢ƒï¼Œä½ ä½œä¸ºå…¬å¸çš„ç³»ç»Ÿç®¡ç†å‘˜ï¼Œè¯·æ ¹æ®ä¸Šè¿°çš„è§„åˆ’è¡¨å’Œä»¥ä¸‹çš„é…ç½®è¦æ±‚ï¼Œå®Œæˆç½‘ç»œæœåŠ¡çš„å®‰è£…ä¸æµ‹è¯•ã€‚

### A. **é“¶æ²³éº’éºŸæœåŠ¡å™¨æ“ä½œç³»ç»Ÿä»»åŠ¡**

## **ä»»åŠ¡1 åŸºç¡€ç¯å¢ƒé…ç½®**

### 	1ï¼æ ¹æ®è¡¨3å®ŒæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„åŸºæœ¬é…ç½®ï¼ŒåŒ…æ‹¬IPåœ°å€ã€ä¸»æœºåã€é˜²ç«å¢™ã€Selinuxç­‰å‚æ•°ã€‚

```shell
hostnamectl set-hostname server # ä¿®æ”¹ä¸»æœºå
```

ã€€ã€€ä¿®æ”¹ `vim /etc/hosts`â€‹ æ–‡ä»¶

```shell
192.168.100.100 server.kylin2024.com server
192.168.100.101 client.kylin2024.com client
```

ã€€ã€€ä¿®æ”¹ `vim /etc/sysconfig/network-scripts/ifcfg-ç½‘å¡åç§°`â€‹

```shell
HWADDR=00:0C:29:EF:73:EC
MACADDR=stable
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static # ä¿®æ”¹ç½‘å¡ç±»å‹ dhcp æˆ– static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_PRIVACY=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens224
UUID=672cecfc-712c-4c93-8258-eff6944ba4b1
DEVICE=ens224
ONBOOT=yes # å¼€å¯ç½‘å¡
# æ·»åŠ ä»¥ä¸‹å†…å®¹
IPADDR=192.168.100.100  # IP
NETMASK=255.255.255.0   # æ©ç 
GATEWAY=192.168.100.1   # ç½‘å…³
DNS1=114.114.114.114    # DNS
```

ã€€ã€€SELinuxé»˜è®¤ä¸ºå…³é—­çŠ¶æ€

â€‹![image](assets/image-20240514212242-5klchdz.png)â€‹

ã€€ã€€Kysecé»˜è®¤å…³é—­

â€‹![image](assets/image-20240514212528-5te9sug.png)â€‹

### 2.é…ç½®FTPæœåŠ¡å™¨

#### (1).æœåŠ¡ç«¯å®‰è£…ftpæœåŠ¡ï¼ŒåŒ¿åå…±äº«/data/ftp/DVDç›®å½•

ã€€ã€€å®‰è£…æœåŠ¡  `yum install vsftpd -y`â€‹

ã€€ã€€ä¿®æ”¹ `/etc/vsftpd/vsftpd.conf`â€‹ æ–‡ä»¶

ã€€ã€€å°† `anonymous_enable`â€‹ ä¿®æ”¹ä¸º `YES`â€‹

â€‹![image](assets/image-20240514215014-yy75uwc.png)â€‹

ã€€ã€€ä¿®æ”¹æˆ–æ·»åŠ ä»¥ä¸‹é…ç½®

```shell
write_enable=YES
anon_upload_enable=YES
anon_mkdir_write_enable=YES
anon_root=/data/ftp/DVD
chroot_local_user=NO
```

ã€€ã€€åˆ›å»ºç›®å½•å¹¶ä¿®æ”¹æƒé™

ã€€ã€€â€‹`mkdir -p /data/ftp/DVD`â€‹

ã€€ã€€â€‹`chmod 755 /data/ftp/DVD`â€‹

ã€€ã€€â€

ã€€ã€€å¼€å¯æœåŠ¡ `systemctl start vsftpd`â€‹

ã€€ã€€è®¾ç½®å¼€å¯è‡ªå¯ `systemctl enable vsftpd`â€‹

#### (2).åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºkylin_ftpæ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶åŒ¿åä¸Šä¼ è‡³/data/ftp/DVDç›®å½•ä¸­

ã€€ã€€åˆ›å»ºæ–‡ä»¶ `touch kylin_ftp`â€‹

ã€€ã€€å®‰è£…ftp å®¢æˆ·ç«¯ `yum install ftp -y`â€‹

ã€€ã€€ç™»å½•ftp `ftp localhost`â€‹

ã€€ã€€ä¸Šä¼ æ–‡ä»¶ `ftp> put kylin_ftp`â€‹

ã€€ã€€æŠ¥é”™553 æš‚æœªè§£å†³

ã€€ã€€â€

ã€€ã€€å¦‚æœç™»å½•æŠ¥é”™500

ã€€ã€€æŠ¥é”™æˆªå›¾

â€‹![image](assets/image-20240514224713-2s3aly7.png)â€‹

ã€€ã€€è§£å†³æ–¹æ¡ˆï¼š

ã€€ã€€ä¸»ç›®å½•ä¿®æ”¹ä¸º755æƒé™

ã€€ã€€æ‹“å±•å­¦ä¹ 

ã€€ã€€â€

ã€€ã€€â€

#### ï¼ˆ3ï¼‰SSHæœåŠ¡åŠ å›º

##### é…ç½®SSHæœåŠ¡ï¼Œç¦æ­¢rootç”¨æˆ·é€šè¿‡SSHç™»å½•

ã€€ã€€ä¿®æ”¹ `/etc/ssh/sshd_config`â€‹ æ–‡ä»¶

ã€€ã€€â€‹`PermitRootLogin`â€‹ æ”¹ä¸º `no`â€‹

â€‹![image](assets/image-20240514230940-dict3jr.png)â€‹

### ï¼ˆ4ï¼‰é€šè¿‡iscsiåè®®åŸºäºæ–‡ä»¶æ–¹å¼å»ºç«‹å­˜å‚¨

#### åˆ›å»º2Gæ–‡ä»¶å­˜å‚¨

ã€€ã€€å®‰è£… `yum install targetcli -y`â€‹

#### æ–‡ä»¶å­˜å‚¨åç§°ï¼š/root/kylin-iscsi-file

ã€€ã€€åˆ›å»ºæ–‡ä»¶ `dd if=/dev/zero of=/root/kylin-iscsi-file bs=1G count=2`â€‹

#### å…±äº«åç§°ï¼šiqn.2024-04.com.kylin:file

ã€€ã€€è‹±è¯­ä¸å¥½ï¼Œå•è¯æ‹¼é”™äº†ğŸ˜­ 

```shell
targetcli
/> cd /backstores/fileio
# åˆ›å»ºå­˜å‚¨ï¼Œkylin_file
/backstores/fileio> create kylin_file /root/kylin-iscsi-file
/backstores/fileio> cd /iscsi
# åˆ›å»ºå…±äº«ï¼Œåç§°iqn.2024-04.com.kyline:file
/iscsi> create iqn.2024-04.com.kyline:file
# æ·»åŠ å­˜å‚¨åˆ°å…±äº«ä¸­
/iscsi> cd /iscsi/iqn.2024-04.com.kyline:file/tpg1/luns
/iscsi/iqn.20...ile/tpg1/luns> create /backstores/fileio/kylin_file
```

#### è¯¥å…±äº«å…è®¸iqn.2024-04.com.kylin:storageæœºå™¨æŒ‚è½½è®¿é—®

```shell
/iscsi/iqn.20...ile/tpg1/luns> cd /iscsi/iqn.2024-04.com.kyline:file/tpg1/acls
# å…è®¸è¿™ä¸ªæœºå™¨è®¿é—®
/iscsi/iqn.20...ile/tpg1/acls> create iqn.2024-04.com.kylin:storage
```

#### firewallé˜²ç«å¢™é…ç½®ï¼Œæ”¾è¡Œç›¸åº”ç«¯å£

```shell
firewall-cmd --add-port=3260/tcp --permanent
firewall-cmd --reload
```

ã€€ã€€è®¾ç½®å¼€æœºè‡ªå¯

```shell
systemctl start target
systemctl enable target
```

### ï¼ˆ5ï¼‰é…ç½®æ—¶é—´æœåŠ¡å™¨ï¼Œè¦æ±‚æ‰€æœ‰è®¡ç®—æœºæ—¶é—´åŒæ­¥

#### é…ç½®chronyæ—¶é—´æœåŠ¡å™¨ï¼Œä½¿ç½‘ç»œä¸­çš„å…¶ä»–è®¡ç®—æœºå‘è¯¥æœåŠ¡å™¨åŒæ­¥æ—¶é—´

ã€€ã€€å®‰è£… `yum install chrony`â€‹

ã€€ã€€ä¿®æ”¹ `/etc/chrony.conf`â€‹  æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹

```shell
allow 192.168.0.0/16
```

ã€€ã€€å¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯

```shell
systemctl start chronyd
systemctl enable chronyd
```

#### firewallé˜²ç«å¢™é…ç½®ï¼Œæ”¾è¡Œç›¸åº”ç«¯å£

ã€€ã€€å¼€æ”¾ç«¯å£ `firewall-cmd --add-port 123/udp`â€‹

ã€€ã€€é‡å¯é˜²ç«å¢™ `firewall-cmd --reload`â€‹ 

## **ä»»åŠ¡2 æ–‡ä»¶å¤¹å…±äº«**

### ï¼ˆ1ï¼‰åœ¨æœåŠ¡ç«¯åˆ›å»º/nfsdataç›®å½•ï¼Œåœ¨/nfsdataç›®å½•ä¸‹åˆ›å»ºkylin01ã€kylin02æ–‡ä»¶å¤¹ï¼Œé€šè¿‡NFSåè®®å…±äº«

ã€€ã€€å®‰è£…æœåŠ¡ ` yum install nfs-utils rpcbind -y`â€‹

ã€€ã€€åˆ›å»ºç›¸å…³æ–‡ä»¶å¤¹

```shell
mkdir -p /nfsdata/kylin01
mkdir -p /nfsdata/kylin02
```

### ï¼ˆ2ï¼‰/nfsdata/kylin01å…±äº«æ–‡ä»¶å¤¹åªå…è®¸å®¢æˆ·ç«¯ä»¥åªè¯»æƒé™æŒ‚è½½

### ï¼ˆ3ï¼‰/nfsdata/kylin02 å…±äº«æ–‡ä»¶å¤¹ä½¿ç”¨åŒ¿åç”¨æˆ·nfsuserè®¿é—®ï¼Œå…·æœ‰è¯»å†™æƒé™

ã€€ã€€æ·»åŠ  `nfsuser`â€‹ ç”¨æˆ·

```shell
useradd nfsuser
# å°†æ–‡ä»¶å¤¹å½’å±ç”¨æˆ·æ”¹ä¸ºnfsuser 
chown nfsuser:nfsuser /nfsdata/kylin02
# ä¿®æ”¹æƒé™ 
chmod 777 /nfsdata/kylin02
```

ã€€ã€€æŸ¥çœ‹ `nfsuser`â€‹ çš„id

â€‹![image](assets/image-20240518163954-1wyk9fi.png)â€‹

ã€€ã€€ä¿®æ”¹ `/etc/exports`â€‹ æ–‡ä»¶

```shell
/nfsdata/kylin01 192.168.100.101/32(ro,sync,no_subtree_check)
/nfsdata/kylin02 192.168.100.101/32(rw,sync,no_subtree_check,anonuid=1001,anongid=1001)

ä¸ºä»€ä¹ˆå¿…é¡»æŒ‡å®šå®¢æˆ·ç«¯åœ°å€æ‰èƒ½æŒ‚è½½æˆåŠŸï¼Ÿ

rwï¼šè¯»å†™
syncï¼šè¡¨ç¤ºæ•°æ®åœ¨è¢«ç¡®è®¤å†™å…¥ç£ç›˜ä¹‹å‰ï¼ŒNFSæœåŠ¡å™¨ä¼šå“åº”å®¢æˆ·ç«¯çš„å†™è¯·æ±‚ã€‚è¿™ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†å¯èƒ½ä¼šç•¥å¾®é™ä½æ€§èƒ½ å¿…é¡»é€‰é¡¹ï¼Ÿ
no_subtree_checkï¼š ç¦ç”¨ subtree checkingï¼Œè¿™æ˜¯ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–é€‰é¡¹ï¼ŒNFSæœåŠ¡å™¨ä¸ä¼šæ£€æŸ¥æ¯ä¸ªæ“ä½œæ˜¯å¦è·¨è¶Šäº†æŒ‚è½½ç‚¹è¾¹ç•Œï¼Œå¯¹äºå¤§å‹æˆ–æ·±åº¦ç›®å½•æ ‘ç»“æ„ç‰¹åˆ«æœ‰ç”¨ å¿…é¡»é€‰é¡¹ï¼Ÿ
anonuidï¼šç”¨æˆ·çš„uid
anongidï¼šç”¨æˆ·çš„gid
```

ã€€ã€€â€

ã€€ã€€å¼€å¯æœåŠ¡  ` exportfs -arv`â€‹

â€‹![image](assets/image-20240518164828-zwj91u2.png)â€‹

ã€€ã€€å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯

```shell
systemctl start nfs-server
systemctl start rpcbind
systemctl enable nfs-server
systemctl enable rpcbind
```

### ï¼ˆ4ï¼‰firewallé˜²ç«å¢™é…ç½®ï¼Œæ”¾è¡Œç›¸åº”ç«¯å£

ã€€ã€€æ”¾è¡Œç›¸å…³æœåŠ¡

```shell
firewall-cmd --add-service=nfs --permanent
firewall-cmd --add-service=rpc-bind --permanent
firewall-cmd --reload
```

## **ä»»åŠ¡3** **Dockerå®¹å™¨éƒ¨ç½²ç®¡ç†**

### 	ï¼ˆ1ï¼‰æœåŠ¡ç«¯éƒ¨ç½²dockerå®¹å™¨æœåŠ¡

### 	ï¼ˆ2ï¼‰æ ¹æ®Nginxå®¹å™¨é•œåƒåˆ›å»ºå®¹å™¨nginx-01ã€‚å®¹å™¨é…ç½®å¦‚ä¸‹ï¼š

ã€€ã€€å®¹å™¨èµ„æºé™åˆ¶

ã€€ã€€CPU:2c

ã€€ã€€Memory:8G

ã€€ã€€â€

ã€€ã€€å®‰è£…dockeræœåŠ¡ `yum install docker`â€‹

â€‹![image](assets/image-20240516230434-fnzdt0h.png)â€‹

ã€€ã€€è®¾ç½®å¼€æœºè‡ªå¯

ã€€ã€€â€‹`systemctl start docker`â€‹

ã€€ã€€â€‹`systemctl enable docker`â€‹

ã€€ã€€æ‹‰å–é•œåƒ `docker pull nginx`â€‹

ã€€ã€€è¿è¡Œå®¹å™¨  `docker run --name nginx-01 -d --cpus="2" --memory="8g" nginx`â€‹

â€‹![image](assets/image-20240516230754-yheertn.png)â€‹

ã€€ã€€æŸ¥çœ‹çŠ¶æ€  `docker ps`â€‹

â€‹![image](assets/image-20240516230842-x6j106x.png)â€‹

ã€€ã€€â€

## **ä»»åŠ¡4 Ansibleè‡ªåŠ¨åŒ–è¿ç»´**

### ï¼ˆ1ï¼‰ å®¢æˆ·ç«¯é€šè¿‡ansible roleså·¥å…·åœ¨æœåŠ¡ç«¯éƒ¨ç½²OpenGaussæ•°æ®åº“

ã€€ã€€è¿™é¢˜ä¸åšäº†

### ï¼ˆ2ï¼‰ æ•°æ®åº“æ“ä½œå…·ä½“å¦‚ä¸‹ï¼š

#### a) å®ŒæˆOpenGaussæ•°æ®åº“çš„å®‰è£…åå¯åŠ¨æ•°æ®åº“ã€‚

#### b) ä½¿ç”¨å‘½ä»¤ç™»å½•æ•°æ®åº“ï¼Œä½¿ç”¨å…ƒå‘½ä»¤å®Œæˆå¦‚ä¸‹æ“ä½œï¼š

1. æŸ¥çœ‹æ•°æ®åº“ç³»ç»Ÿçš„æ•°æ®åº“åˆ—è¡¨
2. åˆ—ä¸¾æ‰€æœ‰çš„è¡¨ã€è§†å›¾å’Œç´¢å¼•
3. æŸ¥è¯¢è¡¨ç©ºé—´

### ï¼ˆ3ï¼‰ åˆ›å»ºè¡¨ç©ºé—´tbs1,å¹¶è®¾å®šæ•°æ®æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ä¸º/opt/openguass/tablespace/tbs1ã€‚

### ï¼ˆ4ï¼‰ åœ¨è¡¨ç©ºé—´tbs1åˆ›å»ºæ•°æ®db1ï¼Œå¹¶åˆ‡æ¢è‡³æ•°æ®åº“db1ã€‚

1. åˆ›å»ºè¡Œå­˜å‚¨è¡¨ï¼šå­¦ç”Ÿä¿¡æ¯è¡¨ï¼ŒåŒ…æ‹¬å­¦å·ï¼Œå§“åï¼Œæ‰‹æœºå·ï¼Œç­çº§ã€‚
2. å‘è¡¨å†…æ’å…¥ä¸€è¡Œæ•°æ®ï¼› 20120101,zhangsan,13522223333,2201
3. æŸ¥è¯¢stuè¡¨ä¸­æ•°æ®

ã€€ã€€ï¼ˆ5ï¼‰ æ‹·è´è¡¨stuä¸­çš„æ•°æ®åˆ°æ–‡ä»¶/guassdb/backup/copy_stuã€‚

ã€€ã€€ï¼ˆ6ï¼‰ firewallé˜²ç«å¢™é…ç½®ï¼Œæ”¾è¡Œç›¸åº”ç«¯å£

# B. **é“¶æ²³éº’éºŸæ¡Œé¢æ“ä½œç³»ç»Ÿä»»åŠ¡**

## **ä»»åŠ¡1** **åŸºç¡€ç¯å¢ƒé…ç½®**

### ï¼ˆ1ï¼‰æŒ‚è½½ISCSIå…±äº«ç£ç›˜

ã€€ã€€å®‰è£… `apt install open-iscsi`â€‹

ã€€ã€€å‘ç°ç›®`iscsiadm -m discovery -t sendtargets -p 192.168.100.100:3260`â€‹

ã€€ã€€ä¿®æ”¹ `/etc/iscsi/initiatorname.iscsi `â€‹ æ–‡ä»¶ 

â€‹![image](assets/image-20240515120755-8feeil8.png)â€‹

ã€€ã€€ç™»å½•ç›®æ ‡ `iscsiadm -m node -T iqn.2024-04.com.kylin:file -p 192.168.100.100:3260 -l`â€‹

â€‹![image](assets/image-20240515220251-3ey0j8n.png)â€‹

ã€€ã€€è¿æ¥ä¸ä¸Šè¯·æ£€æŸ¥é˜²ç«å¢™ï¼Œå¼€æ”¾ç«¯å£3260  æ³¨æ„å®¢æˆ·ç«¯çš„Kysec

ã€€ã€€ä»¥ä¸‹å†…å®¹åŸºäºCentos/Ubuntu/Kylinè¿›è¡Œæµ‹è¯•

ã€€ã€€æŸ¥çœ‹ç™»å½•çŠ¶æ€  `iscsiadm -m session -P 3`â€‹

â€‹![image](assets/image-20240515204455-d9e1yxo.png)â€‹

#### åˆ›å»º/data/storageç›®å½•

ã€€ã€€åˆ›å»ºç›®å½• `mkdir -p /data/storage`â€‹

ã€€ã€€åˆ›å»ºç‰©ç†å· `pvcreate /dev/sda`â€‹ å¦‚æœå¤±è´¥ï¼Œåˆ™åŠ ä¸Š `-ff`â€‹ å¼ºåˆ¶æ‰§è¡Œ

#### åˆ›å»ºå·ç»„åç§°ä¸ºkylin_vg

ã€€ã€€åˆ›å»ºå·ç»„ `vgcreate kylin_vg /dev/sda`â€‹

#### å°†æ–‡ä»¶å­˜å‚¨çš„æ‰€æœ‰ç©ºé—´å®¹é‡åŠ å…¥å·ç»„kylin_vg

#### åœ¨å·ç»„kylin_vgä¸Šå°†å…¨éƒ¨å®¹é‡åˆ†é…ç»™é€»è¾‘å·ï¼Œåç§°ä¸ºkylin_lv

ã€€ã€€åˆ›å»ºé€»è¾‘å· `lvcreate -l +100%FREE -n kylin_lv kylin_vg`â€‹

#### æ ¼å¼åŒ–é€»è¾‘å·kylin_lvï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ºext4

ã€€ã€€æ ¼å¼åŒ–ä¸ºext4  `mkfs.ext4 /dev/kylin_vg/kylin_lv`â€‹

#### å°†é€»è¾‘å·kylin_lvæŒ‚è½½åˆ°/data/storageç›®å½•,å¹¶è¦æ±‚å¼€æœºè‡ªåŠ¨æŒ‚è½½

ã€€ã€€æŒ‚è½½ `mount /dev/kylin_vg/kylin_lv /data/storage`â€‹

ã€€ã€€æŸ¥çœ‹é€»è¾‘å·ID  `blkid /dev/kylin_vg/kylin_lv`â€‹

â€‹![image](assets/image-20240515205937-9teazp6.png)â€‹

ã€€ã€€æ‰§è¡Œ `iscsiadm -m node -T iqn.2024-04.com.kyline:file -p 192.168.100.100:3260 --op update -n node.startup -v automatic`â€‹ è®¾ç½®å¼€æœºè‡ªå¯ï¼Œæ­¤å‘½ä»¤æ²¡æœ‰è¿”å›å€¼

ã€€ã€€â€

ã€€ã€€ä¿®æ”¹ `/etc/fstab`â€‹ æ–‡ä»¶

ã€€ã€€æ·»åŠ ä»¥ä¸‹å†…å®¹

```shell
UUID=8a3c3d7b-0ba4-421a-9935-b23a7b35b886 /data/storage ext4 defaults,_netdev 0 0
```

### ï¼ˆ2ï¼‰å‘æœåŠ¡å™¨åŒæ­¥æ—¶é—´

ã€€ã€€å®‰è£… `apt install chrony -y`â€‹

ã€€ã€€ä¿®æ”¹ `/etc/chrony/chrony.conf`â€‹ æ–‡ä»¶

ã€€ã€€æ·»åŠ ä»¥ä¸‹å†…å®¹

```shell

server 192.168.100.100 iburst
```

ã€€ã€€è®¾ç½®å¼€æœºè‡ªå¯

ã€€ã€€â€‹`systemctl start chrony
systemctl enable chrony`â€‹

ã€€ã€€â€

ã€€ã€€åŒæ­¥æˆåŠŸ

â€‹![image](assets/image-20240515225617-0yq7ts1.png)â€‹

ã€€ã€€â€

ã€€ã€€**ä»»åŠ¡2** **æ–‡ä»¶å¤¹å…±äº«**

### åœ¨å®¢æˆ·ç«¯çš„/data/ç›®å½•ä¸‹åˆ›å»ºclient01ã€client02æ–‡ä»¶å¤¹ï¼Œé€šè¿‡NFSåè®®å…±äº«ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š

ã€€ã€€å®‰è£…æœåŠ¡ `apt install nfs-common`â€‹

ã€€ã€€åˆ›å»ºç›¸å…³æ–‡ä»¶å¤¹

```shell
mkdir -p /data/client01
mkdir -p /data/client02
```

#### /nfsdata/kylin01å…±äº«æ–‡ä»¶å¤¹åªå…è®¸å®¢æˆ·ç«¯ä»¥åªè¯»æƒé™æŒ‚è½½åˆ°æœ¬æœºçš„/data/client01ç›®å½•ï¼Œä¸”å¼€æœºè‡ªåŠ¨æŒ‚è½½

#### /nfsdata/kylin02 å…±äº«æ–‡ä»¶å¤¹ä½¿ç”¨åŒ¿åç”¨æˆ·nfsuserè®¿é—®æœ¬æœºçš„/data/client02ç›®å½•ï¼Œä¸”å¼€æœºè‡ªåŠ¨æŒ‚è½½

ã€€ã€€ä¿®æ”¹ `/etc/fstab`â€‹ æ–‡ä»¶

```shell
#nfs
192.168.100.100:/nfsdata/kylin01                /data/client01  nfs             defaults        0 0
192.168.100.100:/nfsdata/kylin02                /data/client02  nfs             defaults        0 0
```

ã€€ã€€â€

ã€€ã€€å°è¯•æŒ‚è½½

```shell
mount /data/client01
mount /data/client02
```

### **ä»»åŠ¡3** **Dockerå®¹å™¨éƒ¨ç½²ç®¡ç†**

ã€€ã€€å®¢æˆ·ç«¯æ— éœ€æ“ä½œ

###  **ä»»åŠ¡4Ansibleè‡ªåŠ¨åŒ–è¿ç»´**

#### å®¢æˆ·ç«¯éƒ¨ç½²Ansibleè½¯ä»¶ï¼Œå¹¶é…ç½®Ansible rolesè§’è‰²ï¼Œé€šè¿‡rolesä½¿æœåŠ¡ç«¯ä¸€é”®å®Œæˆmysqlæ•°æ®åº“çš„éƒ¨ç½²

ã€€ã€€éƒ¨ç½²mysqlè¿˜æ˜¯openGaussï¼Ÿ

ã€€ã€€â€

ã€€ã€€ä¸‹é¢çš„å†…å®¹ä¸ç”¨çœ‹äº†ï¼Œæ²¡æœ‰éƒ¨ç½²æˆåŠŸ

ã€€ã€€â€

ã€€ã€€è¿™é¢˜ä¸åšäº†

ã€€ã€€å®‰è£…æœåŠ¡ `apt install ansible`â€‹

ã€€ã€€â€

ã€€ã€€ä¿®æ”¹ `/etc/ansible/hosts `â€‹ æ–‡ä»¶

ã€€ã€€æ·»åŠ ä»¥ä¸‹å†…å®¹

```shell
[openGaussdb]
192.168.100.100 ansible_ssh_user=root ansible_ssh_pass=Centos123
```

ã€€ã€€æµ‹è¯•è¿é€šæ€§ æŠ¥é”™

ã€€ã€€â€‹`ansible -i /etc/ansible/hosts openGaussdb -m ping`â€‹

â€‹![image](assets/image-20240518202715-r3rvnpf.png)â€‹

ã€€ã€€å®‰è£…æœåŠ¡ `apt install sshpass -y`â€‹

ã€€ã€€è¿™æ—¶ï¼Œå†æ¬¡æŠ¥é”™

â€‹![image](assets/image-20240518203517-ifokh3l.png)â€‹

ã€€ã€€æ‰§è¡Œ `ssh-keyscan -H 192.168.100.100 >> ~/.ssh/known_hosts`â€‹

â€‹![image](assets/image-20240518203537-a02kf1h.png)â€‹

ã€€ã€€å†æ¬¡æµ‹è¯• `ansible -i /etc/ansible/hosts openGaussdb -m ping`â€‹

â€‹![image](assets/image-20240518203557-y59a05s.png)â€‹

ã€€ã€€æˆåŠŸ

ã€€ã€€â€

ã€€ã€€åˆ›å»ºè§’è‰² `ansible-galaxy init openGauss`â€‹

ã€€ã€€ä¿®æ”¹ `openGauss/tasks/main.yml`â€‹ æ–‡ä»¶

ã€€ã€€æ·»åŠ ä»¥ä¸‹å†…å®¹

```shell
- name: Add OpenGauss repository
  apt_repository:
    repo: 'deb [trusted=yes] http://opengauss.org/download/debian {{ ansible_lsb.codename }} main'
    state: present

- name: Install OpenGauss
  apt:
    name: openGauss-server
    state: present

- name: Configure OpenGauss
```

ã€€ã€€â€

ã€€ã€€â€

## openGausså®‰è£…

ã€€ã€€æµ‹è¯•ç¯å¢ƒï¼šopenEuler22.03    openGauss5.0.2  Centos7  KylinV10-server

ã€€ã€€openGaussä¸‹è½½ï¼š[https://opengauss.org/zh/download/](https://opengauss.org/zh/download/)

### 1.å®‰è£…å‰å‡†å¤‡

#### 1.1 å®‰è£…æµç¨‹

ã€€ã€€**å®‰è£…æµç¨‹ï¼š**

â€‹![image](assets/image-20240531214237-7obu9ow.png)â€‹

|æµç¨‹|è¯´æ˜|
| ---------------------| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|å®‰è£…å‰å‡†å¤‡|openGausså®‰è£…å‰éœ€è¦å‡†å¤‡ç›¸åº”çš„è½¯ç¡¬ä»¶ç¯å¢ƒä»¥åŠå®Œæˆç›¸å…³é…ç½®ã€‚<br />æœ¬æ–‡æ¡£æä¾›äº†openGausså®‰è£…æ‰€éœ€çš„æœ€ä½è¦æ±‚ï¼Œå®é™…å®‰è£…ä¸­ï¼Œè¯·ç”¨æˆ·æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè§„åˆ’ã€‚<br />æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ[å®‰è£…å‡†å¤‡](https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/InstallationGuide/%E5%AE%89%E8%A3%85%E5%87%86%E5%A4%87_%E4%BC%81%E4%B8%9A%E7%89%88.html)ã€‚|
|è·å–å¹¶æ ¡éªŒå®‰è£…åŒ…|å®‰è£…åŒ…éœ€è¦åœ¨openGausså¼€æºç¤¾åŒºä¸‹è½½å¹¶ä¸”å¯¹å®‰è£…åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œè¯¦ç»†è¯·å‚è§[è·å–å®‰è£…åŒ…](https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/InstallationGuide/%E8%8E%B7%E5%8F%96%E5%AE%89%E8%A3%85%E5%8C%85_%E4%BC%81%E4%B8%9A%E7%89%88.html)ã€‚|
|é…ç½®XMLæ–‡ä»¶|å®‰è£…openGausså‰éœ€è¦åˆ›å»ºXMLæ–‡ä»¶ã€‚XMLæ–‡ä»¶åŒ…å«éƒ¨ç½²openGaussçš„æœåŠ¡å™¨ä¿¡æ¯ã€å®‰è£…è·¯å¾„ã€IPåœ°å€ä»¥åŠç«¯å£å·ç­‰ã€‚ç”¨äºå‘ŠçŸ¥openGausså¦‚ä½•éƒ¨ç½²ã€‚ç”¨æˆ·éœ€æ ¹æ®ä¸åŒåœºæ™¯é…ç½®å¯¹åº”çš„XMLæ–‡ä»¶ã€‚<br />å…³äºå¦‚ä½•é…ç½®XMLæ–‡ä»¶ï¼Œè¯¦ç»†è¯·å‚è§[åˆ›å»ºXMLé…ç½®æ–‡ä»¶](https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/InstallationGuide/%E5%88%9B%E5%BB%BAXML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html)ã€‚|
|ä¸Šä¼ å®‰è£…åŒ…å’ŒXMLæ–‡ä»¶|ä¸Šä¼ å®‰è£…åŒ…å’ŒXMLé…ç½®æ–‡ä»¶åˆ°å¾…å®‰è£…çš„æœåŠ¡å™¨ã€‚|
|è§£å‹å®‰è£…åŒ…|ä½¿ç”¨tarå‘½ä»¤è§£å‹å®‰è£…åŒ…ã€‚|
|åˆå§‹åŒ–å®‰è£…ç¯å¢ƒ|å®‰è£…ç¯å¢ƒçš„åˆå§‹åŒ–åŒ…å«ä¸Šä¼ å®‰è£…åŒ…å’ŒXMLæ–‡ä»¶ã€è§£å‹å®‰è£…åŒ…ã€ä½¿ç”¨gs_preinstallå‡†å¤‡å¥½å®‰è£…ç¯å¢ƒã€‚<br />å…³äºå¦‚ä½•åˆå§‹åŒ–å®‰è£…ç¯å¢ƒï¼Œè¯¦ç»†è¯·å‚è§[åˆå§‹åŒ–å®‰è£…ç¯å¢ƒ](https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/InstallationGuide/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83.html)ã€‚|
|æ‰§è¡Œå®‰è£…|ä½¿ç”¨gs_installå®‰è£…openGaussã€‚<br />å…³äºå¦‚ä½•æ‰§è¡Œå®‰è£…ï¼Œè¯¦ç»†è¯·å‚è§[æ‰§è¡Œå®‰è£…](https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/InstallationGuide/%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85.html)ã€‚|
|è®¾ç½®å¤‡æœºå¯è¯»|å¯é€‰æ“ä½œã€‚åœ¨å¼€å¯å¤‡æœºå¯è¯»ä¹‹åï¼Œå¤‡æœºå°†æ”¯æŒè¯»æ“ä½œï¼Œå¹¶æ»¡è¶³æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€‚|

#### 1.2 é…ç½®ç³»ç»Ÿç¯å¢ƒ

ã€€ã€€ä¸‹è½½å®‰è£…åŒ…

```shell
wget https://opengauss.obs.cn-south-1.myhuaweicloud.com/5.0.2/arm_2203/openGauss-5.0.2-openEuler-64bit-all.tar.gz
```

ã€€ã€€**è®¾ç½®å­—ç¬¦é›†å‚æ•°**

ã€€ã€€ä¿®æ”¹æ–‡ä»¶ `/etc/profile`â€‹ï¼Œæ·»åŠ  `export LANG=en_US.UTFâ€8`â€‹ åˆ°æœ«å°¾

```shell
echo "export LANG= en_US.UTFâ€8" >> /etc/profile
```

â€‹![image](assets/image-20240531221259-im3ircw.png)â€‹

ã€€ã€€åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œä½¿æ–°é…ç½®ç”Ÿæ•ˆ

```shell
source /etc/profile
```

ã€€ã€€**ä¿®æ”¹Pythonä¸º3.7**

ã€€ã€€ä¹‹åå®‰è£…è¿‡ç¨‹ä¸­openGaussç”¨æˆ·äº’ä¿¡ï¼ŒopenEuleræœåŠ¡å™¨éœ€è¦ç”¨åˆ°Python-3.7.xå‘½ä»¤ï¼Œä½†æ˜¯é»˜è®¤Pythonç‰ˆæœ¬ä¸ºPython-2.7.xï¼Œæ‰€ä»¥éœ€è¦åˆ‡æ¢Pythonç‰ˆæœ¬ã€‚

ã€€ã€€è¿›å…¥/usr/binç›®å½•ã€‚

ã€€ã€€â€‹`cd /usr/bin/`â€‹

ã€€ã€€å¤‡ä»½pythonæ–‡ä»¶

ã€€ã€€â€‹`mv python python.bak `â€‹

ã€€ã€€å»ºç«‹Python3è½¯è¿æ¥ã€‚

ã€€ã€€â€‹`ln -s python3 /usr/bin/python `â€‹

ã€€ã€€Euleré»˜è®¤ä¸ºpython3ï¼Œç‰ˆæœ¬3.9.9

ã€€ã€€Eulerï¼š`ln -s python3 python`â€‹

ã€€ã€€éªŒè¯Pythonç‰ˆæœ¬ã€‚

ã€€ã€€â€‹`python -V `â€‹

â€‹![image](assets/image-20240531221908-sb69wxn.png)â€‹

ã€€ã€€**å®‰è£…ç›¸å…³æœåŠ¡**

ã€€ã€€â€‹`yum install libaio* -y`â€‹

### 2 å®‰è£…openGauss

#### 2.1 è§£å‹å®‰è£…åŒ…

```shell
mkdir -p /opt/software/opengauss  
chmod 755 /opt/software/opengauss/
mv openGauss-5.0.2-openEuler-64bit-all.tar.gz /opt/software/opengauss
```

#### 2.2**åˆ›å»ºXMLæ–‡ä»¶ï¼Œç”¨äºå®‰è£…æ•°æ®åº“**

```shell
vim clusterconfig.xml
```

ã€€ã€€æ·»åŠ ä»¥ä¸‹å†…å®¹

ã€€ã€€ï¼‚opengauss01ï¼‚æ˜¯æœåŠ¡å™¨çš„ä¸»æœºåï¼Œï¼‚192.xxx.x.xxï¼‚ä¸ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ˆç§æœ‰ï¼‰ï¼Œä¾‹å¦‚ï¼š192.168.133.154ï¼›å…¶ä»–valueå€¼å¯ä»¥ä¸è¿›è¡Œä¿®æ”¹ã€‚

```shell
<?xml version="1.0" encoding="UTF-8"?> 
<ROOT> 
    <CLUSTER> 
        <PARAM name="clusterName" value="dbCluster" /> 
        <PARAM name="nodeNames" value="opengauss01" /> 
        <PARAM name="backIp1s" value="192.168.133.154"/> 
        <PARAM name="gaussdbAppPath" value="/opt/gaussdb/app" /> 
        <PARAM name="gaussdbLogPath" value="/var/log/gaussdb" /> 
        <PARAM name="gaussdbToolPath" value="/opt/huawei/wisequery" /> 
        <PARAM name="corePath" value="/opt/opengauss/corefile"/> 
        <PARAM name="clusterType" value="single-inst"/> 
    </CLUSTER> 
   
    <DEVICELIST> 
  
        <DEVICE sn="1000001"> 
            <PARAM name="name" value="opengauss01"/> 
            <PARAM name="azName" value="AZ1"/> 
            <PARAM name="azPriority" value="1"/> 
            <PARAM name="backIp1" value="192.168.133.154"/> 
            <PARAM name="sshIp1" value="192.168.133.154"/> 
   
	    <!--dbnode--> 
	    <PARAM name="dataNum" value="1"/> 
	    <PARAM name="dataPortBase" value="26000"/> 
	    <PARAM name="dataNode1" value="/gaussdb/data/db1"/> 
        </DEVICE> 
    </DEVICELIST> 
</ROOT>
```

|**å‚æ•°**|**è¯´æ˜**|
| -----------------| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|clusterName|openGaussåç§°ã€‚|
|nodeNames|openGaussä¸­ä¸»æœºåç§°ã€‚|
|backIp1s|ä¸»æœºåœ¨åç«¯å­˜å‚¨ç½‘ç»œä¸­çš„IPåœ°å€ï¼ˆå†…ç½‘IPï¼‰ã€‚æ‰€æœ‰openGaussä¸»æœºä½¿ç”¨åç«¯å­˜å‚¨ç½‘ç»œé€šè®¯ã€‚|
|gaussdbAppPath|openGaussç¨‹åºå®‰è£…ç›®å½•ã€‚æ­¤ç›®å½•åº”æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />â€¢ç£ç›˜ç©ºé—´>1GBã€‚<br />â€¢ä¸æ•°æ®åº“æ‰€éœ€å…¶å®ƒè·¯å¾„ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰åŒ…å«å…³ç³»ã€‚|
|gaussdbLogPath|openGaussè¿è¡Œæ—¥å¿—å’Œæ“ä½œæ—¥å¿—å­˜å‚¨ç›®å½•ã€‚æ­¤ç›®å½•åº”æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />â€¢ç£ç›˜ç©ºé—´å»ºè®®æ ¹æ®ä¸»æœºä¸Šçš„æ•°æ®åº“èŠ‚ç‚¹æ•°è§„åˆ’ã€‚æ•°æ®åº“èŠ‚ç‚¹é¢„ç•™1GBç©ºé—´çš„åŸºç¡€ä¸Šï¼Œå†é€‚å½“é¢„ç•™å†—ä½™ç©ºé—´ã€‚<br />â€¢ä¸openGaussæ‰€éœ€å…¶å®ƒè·¯å¾„ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰åŒ…å«å…³ç³»ã€‚<br />æ­¤è·¯å¾„å¯é€‰ã€‚ä¸æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒopenGausså®‰è£…æ—¶ä¼šé»˜è®¤æŒ‡å®šï¼‚$GAUSSLOG/å®‰è£…ç”¨æˆ·åï¼‚ä½œä¸ºæ—¥å¿—ç›®å½•ã€‚|
|tmpdbPath|æ•°æ®åº“ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•ã€‚<br />è‹¥ä¸é…ç½®tmpdbPathï¼Œé»˜è®¤å­˜æ”¾åœ¨/opt/huawei/wisequery/perfadm_dbç›®å½•ä¸‹ã€‚|
|gaussdbToolPath|openGaussç³»ç»Ÿå·¥å…·ç›®å½•ï¼Œä¸»è¦ç”¨äºå­˜æ”¾äº’ä¿¡å·¥å…·ç­‰ã€‚æ­¤ç›®å½•åº”æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />â€¢ç£ç›˜ç©ºé—´>100MBã€‚<br />â€¢å›ºå®šç›®å½•ï¼Œä¸æ•°æ®åº“æ‰€éœ€å…¶å®ƒç›®å½•ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰åŒ…å«å…³ç³»ã€‚<br />æ­¤ç›®å½•ä¸ºå¯é€‰é…ç½®é¡¹ã€‚ä¸æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒopenGausså®‰è£…æ—¶ä¼šé»˜è®¤æŒ‡å®šï¼‚/opt/huawei/wisequeryï¼‚ä½œä¸ºæ•°æ®åº“ç³»ç»Ÿå·¥å…·ç›®å½•ã€‚|
|corePath|openGauss coreæ–‡ä»¶çš„æŒ‡å®šç›®å½•ã€‚|

ã€€ã€€é¡»çŸ¥ï¼š

* ï¼‚/opt/huawei/newsql/toolsï¼‚å­˜æ”¾äº’ä¿¡ç­‰å·¥å…·ï¼Œé¿å…æƒé™é—®é¢˜ï¼Œä¸è¦æŠŠå®ä¾‹æ•°æ®ç›®å½•æ”¾åœ¨æ­¤ç›®å½•ä¸‹ã€‚
* å®‰è£…ç›®å½•å’Œæ•°æ®ç›®å½•é¡»ä¸ºç©ºæˆ–è€…ä¸å­˜åœ¨ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å®‰è£…å¤±è´¥ã€‚
* åœ¨å¯¹æ•°æ®åº“èŠ‚ç‚¹çš„å®ä¾‹è¿›è¡Œå…·ä½“é…ç½®æ—¶ï¼Œéœ€ç¡®ä¿é…ç½®çš„ç›®å½•ä¹‹é—´ä¸ç›¸äº’è€¦åˆã€‚å³å„ä¸ªé…ç½®ç›®å½•ä¸å…³è”ï¼Œåˆ é™¤å…¶ä¸­ä»»æ„ä¸€ä¸ªç›®å½•ï¼Œä¸ä¼šçº§è”åˆ é™¤å…¶å®ƒç›®å½•ã€‚å¦‚gaussdbAppPathä¸ºï¼‚/opt/gaussdb/appï¼‚ï¼ŒgaussdbLogPathä¸ºï¼‚/opt/gaussdb/app/ommï¼‚ã€‚å½“gaussdbAppPathç›®å½•è¢«åˆ é™¤æ—¶ï¼Œä¼šçº§è”åˆ é™¤gaussdbLogPathç›®å½•ï¼Œä»è€Œå¼•èµ·å…¶å®ƒé—®é¢˜ã€‚
* è‹¥éœ€è¦å®‰è£…è„šæœ¬è‡ªåŠ¨åˆ›å»ºå®‰è£…ç”¨æˆ·æ—¶ï¼Œå„é…ç½®çš„ç›®å½•éœ€ä¿è¯ä¸ä¸ç³»ç»Ÿåˆ›å»ºçš„é»˜è®¤ç”¨æˆ·ç›®å½•è€¦åˆå…³è”ã€‚
* é…ç½®openGaussè·¯å¾„å’Œå®ä¾‹è·¯å¾„æ—¶ï¼Œè·¯å¾„ä¸­ä¸èƒ½åŒ…å«ï¼‚|ï¼‚,ï¼‚;ï¼‚,ï¼‚&ï¼‚,ï¼‚$ï¼‚,ï¼‚<ï¼‚,ï¼‚>ï¼‚,ï¼‚`ï¼‚,ï¼‚\ï¼‚,ï¼‚'ï¼‚,ï¼‚\ï¼‚,ï¼‚{ï¼‚,ï¼‚}ï¼‚,ï¼‚(ï¼‚,ï¼‚)ï¼‚,ï¼‚[ï¼‚,ï¼‚]ï¼‚,ï¼‚~ï¼‚,ï¼‚*ï¼‚,ï¼‚?ï¼‚ç‰¹æ®Šå­—ç¬¦ã€‚

#### 2.3 ç¡®ä¿opensslç‰ˆæœ¬æ­£ç¡®

ã€€ã€€æ‰§è¡Œé¢„å®‰è£…å‰åŠ è½½å®‰è£…åŒ…ä¸­libåº“

ã€€ã€€æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼Œå…¶ä¸­packagePathä¸ºç”¨æˆ·å®‰è£…åŒ…æ”¾ç½®çš„è·¯å¾„ï¼Œæœ¬ç¤ºä¾‹ä¸­ä¸º/opt/software/openGaussã€‚

```shell
cat >>/etc/profile<<END
export packagePath=/opt/software/openGauss
export LD_LIBRARY_PATH=$packagePath/script/gspylib/clib:$LD_LIBRARY_PATH
END
```

ã€€ã€€åˆ·æ–°é…ç½®

ã€€ã€€â€‹`source /etc/profile`â€‹

#### 2.4 è§£å‹å®‰è£…åŒ…

```shell
cd /opt/software/opengauss/
tar -xzvf openGauss-5.0.2-openEuler-64bit-all.tar.gz
tar -xzvf openGauss-5.0.2-openEuler-64bit-om.tar.gz
```

ã€€ã€€å®‰è£…åŒ…è§£å‹åï¼Œä¼šåœ¨/opt/software/openGaussè·¯å¾„ä¸‹è‡ªåŠ¨ç”Ÿæˆscriptå­ç›®å½•ï¼Œå¹¶ä¸”åœ¨scriptç›®å½•ä¸‹ç”Ÿæˆgs_preinstallç­‰å„ç§OMå·¥å…·è„šæœ¬ã€‚

```shell
cd script/
ll
```

â€‹![image](assets/image-20240531224818-b92dlz2.png)â€‹

#### 2.5 äº¤äº’å¼å®‰è£…

```shell
python gs_preinstall -U omm -G dbgrp -X /opt/software/openGauss/clusterconfig.xml
```

ã€€ã€€æŠ¥é”™Error: os architecture is x86_64, package architecture is aarch64

ã€€ã€€ä¸‹è½½é”™ç‰ˆæœ¬äº†ï¼Œæ ¹æ®è‡ªå·±çš„æ¶æ„ä¸‹è½½openGaussç‰ˆæœ¬ï¼Œä½¿ç”¨`arch`â€‹æŸ¥è¯¢æ¶æ„

ã€€ã€€æç¤º[GAUSS-50236] : The /opt/software/openGauss/clusterconfig.xml does not exist or the permission on the upper-layer directory is insufficient. æ‰¾ä¸åˆ°æ–‡ä»¶

ã€€ã€€æ£€æŸ¥æ–‡ä»¶è·¯å¾„ åŒºåˆ†å¤§å°å†™

ã€€ã€€æŠ¥é”™[GAUSS-51620] : Failed to obtain local instance information. It is not a host name bogon.

ã€€ã€€ä¿®æ”¹ä¸»æœºåï¼Œæ³¨æ„ä¸xmlæ–‡ä»¶çš„`nodeNames`â€‹å­—æ®µä¿æŒä¸€è‡´ï¼ŒåŒæ—¶ä¸`<DEVICE sn="1000001">`â€‹ä¸‹çš„`name`â€‹å­—æ®µä¸€è‡´

ã€€ã€€æŠ¥é”™ImportError: libpython3.6m.so.1.0: cannot open shared object file: No such file or directory

ã€€ã€€ç¼ºå°‘ libpython3.6m.so.1.0 åº“

ã€€ã€€ç³»ç»Ÿä¸­å­˜åœ¨ibpython3.7m.so.1.0ï¼Œåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘3.6å³å¯

ã€€ã€€â€‹`find / -name libpython*m.so.1.0`â€‹

â€‹![image](assets/image-20240602151707-81ezi6r.png)â€‹

ã€€ã€€â€‹`ln -s /usr/lib64/libpython3.7m.so.1.0 /usr/lib64/libpython3.6m.so.1.0`â€‹

ã€€ã€€é¢„å®‰è£…å‘½ä»¤æ‰§è¡Œæ—¶å¡ä½ï¼Œæ²¡æœ‰è¾“å‡ºå†…å®¹

ã€€ã€€æ·»åŠ  `--unused-third-party`â€‹ å¯é€‰é¡¹

ã€€ã€€æŠ¥é”™Error: os architecture is x86_64, package architecture is

ã€€ã€€éº’éºŸï¼šæ¶æ„ä¸€è‡´ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæŠ¥é”™

ã€€ã€€å‡è£…è‡ªå·±æ˜¯centosä¹Ÿä¸è¡Œï¼Œä¿®æ”¹æºç ï¼Œè·³è¿‡æ£€æµ‹

ã€€ã€€ä¿®æ”¹ `/opt/software/opengauss/script/gspylib/common/CheckPythonVersion.py`â€‹   æ–‡ä»¶çš„ `check_os_and_package_arch()`â€‹ å‡½æ•°

ã€€ã€€åœ¨68è¡Œé™„è¿‘ï¼Œæ³¨é‡Šæ‰

â€‹![image](assets/image-20240602160419-5vr6mt0.png)â€‹

ã€€ã€€æŠ¥é”™ModuleNotFoundError: No module named 'netifaces'

ã€€ã€€ç¼ºå°‘è¯¥æ¨¡å—ï¼Œå®‰è£…å³å¯ï¼Œå…¶ä»–æ¨¡å—ä¸€è‡´å¤„ç†

ã€€ã€€â€‹`pip3 install netifaces`â€‹

ã€€ã€€æŠ¥é”™[GAUSS-50201] : The ['openGauss-5.0.2-openEuler-64bit.tar.bz2', 'openGauss-5.0.2-Kylin-64bit.tar.bz2', 'openGauss-5.0.2-UnionTech-64bit.tar.bz2'] does not exist.

ã€€ã€€è¿”å›ä¸Šçº§ç›®å½•

ã€€ã€€ä¿®æ”¹ç›¸å…³æ–‡ä»¶å

â€‹![image](assets/image-20240602162056-dq4iotd.png)â€‹

ã€€ã€€[GAUSS-51103] : Failed to execute the PSSH command [encrypt ...].Error is:./encrypt: error while loading shared libraries: libreadline.so.6: cannot open shared object file: No such file or directory

ã€€ã€€è¿›å…¥`/lib64`â€‹ ç›®å½•

â€‹![image](assets/image-20240602163324-ramnyye.png)â€‹

ã€€ã€€æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºè½¯é“¾æ¥

ã€€ã€€[GAUSS-52400] : Installation environment does not meet the desired result.  
Please get more details by "/opt/software/opengauss/script/gs_checkos -i A -h kylin --detail".

ã€€ã€€å®‰è£…ç¯å¢ƒä¸æ»¡è¶³è¦æ±‚ï¼Œ`/opt/software/opengauss/script/gs_checkos -i A -h kylin --detail`â€‹ æŒ‰è¦æ±‚ä¿®æ”¹

ã€€ã€€â€

ã€€ã€€å‘½ä»¤ä¸­çš„ommä¸ºæ“ä½œç³»ç»Ÿç”¨æˆ·ï¼ˆåŒæ—¶ommä¹Ÿæ˜¯openGaussçš„æ•°æ®åº“ç®¡ç†å‘˜è´¦å·ï¼‰ï¼Œdbgrpä¸ºè¿è¡ŒopenGaussçš„æ“ä½œç³»ç»Ÿç”¨æˆ·çš„ç¾¤ç»„åç§°ï¼Œ/opt/software/openGauss/clusterconfig.xmlä¸ºopenGaussé…ç½®æ–‡ä»¶è·¯å¾„ã€‚

ã€€ã€€åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·æ ¹æ®æç¤ºé€‰æ‹©æ˜¯å¦åˆ›å»ºäº’ä¿¡ï¼Œå¡«å†™ yesã€‚

ã€€ã€€æ­¤æ—¶ä¼šåˆ›å»ºæ“ä½œç³»ç»Ÿommç”¨æˆ·ï¼Œå¹¶å¯¹ommåˆ›å»ºtrustäº’ä¿¡ï¼Œå¹¶è¦æ±‚è®¾ç½®å¯†ç ï¼Œè®¾ç½®ä¸ºAdmin@123ï¼ˆå»ºè®®ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®å¯†ç ï¼‰ã€‚

â€‹![image](assets/image-20240531230856-k9e8g5g.png)â€‹

#### 2.6 å¼€å§‹å®‰è£…

```shell
chmod -R 755 /opt/software/openGauss/script/
su - omm
```

ã€€ã€€ommæŒ‡çš„æ˜¯å‰ç½®è„šæœ¬gs_preinstallä¸­-Uå‚æ•°æŒ‡å®šçš„ç”¨æˆ·ã€‚

ã€€ã€€å®‰è£…è„šæœ¬gs_installå¿…é¡»ä»¥å‰ç½®è„šæœ¬ä¸­æŒ‡å®šçš„ommæ‰§è¡Œï¼Œå¦åˆ™ï¼Œè„šæœ¬æ‰§è¡Œä¼šæŠ¥é”™ã€‚

```shell
gs_install -X /opt/software/openGauss/clusterconfig.xml --gsinit-parameter="--encoding=UTF8"  --dn-guc="max_process_memory=5GB"  --dn-guc="shared_buffers=256MB" --dn-guc="bulk_write_ring_size=256MB" --dn-guc="cstore_buffers=16MB"

```

ã€€ã€€æç¤ºgs_installä¸å­˜åœ¨ -bash: gs_install: command not found

ã€€ã€€ä½¿ç”¨ç»å¯¹è·¯å¾„ `/opt/software/openGauss/script/gs_install`â€‹

ã€€ã€€æç¤ºæ“ä½œæ–‡ä»¶æ—¶æ²¡æœ‰æƒé™

ã€€ã€€ä½¿ç”¨rootç”¨æˆ·å°†æ–‡ä»¶å¤¹æ”¹777

ã€€ã€€Exception: [GAUSS-51802] : Failed to obtain the environment variable PGHOST.

ã€€ã€€çŒœæµ‹æ˜¯ä¸»æœºåï¼Œä¿®æ”¹æˆä¸»æœºåå¹¶æ²¡æœ‰è§£å†³é—®é¢˜

â€‹![image](assets/image-20240531232102-z9pdquq.png)â€‹

ã€€ã€€è®¾ç½®ç›‘å¬åœ°å€

```shell
export PGHOST=localhost
source ~/.bashc
```

â€‹![image](assets/image-20240531232504-n5dg44u.png)â€‹

ã€€ã€€ä¿®æ”¹ä¸ç”Ÿæ•ˆï¼Ÿ

```shell
vi .bashc
```

â€‹![image](assets/image-20240531232809-bmtj6bb.png)â€‹

ã€€ã€€Exception: [GAUSS-50201] : The 192.168.133.154 does not exist. Please check it.

ã€€ã€€æ¬§æ‹‰æŠ¥é”™ï¼Œè€Œcentoså´æ²¡æœ‰æ­¤é—®é¢˜

ã€€ã€€å®é™…ä¸Šï¼Œcentosçš„`PGHOST`â€‹å€¼ä¸º`/opt/huawei/wisequery/omm_mppdb`â€‹

ã€€ã€€æ¬§æ‹‰æ‰§è¡Œ`export PGHOST=/opt/huawei/wisequery/omm_mppdb`â€‹

ã€€ã€€é‡æ–°å®‰è£…æŠ¥é”™ `Exception: [GAUSS-50201] : The /opt/huawei/wisequery/omm_mppdb does not exist. Please check it.`â€‹

ã€€ã€€å®é™…ä¸­ï¼Œeluerçš„/optç›®å½•ä¸‹æ²¡æœ‰ç›¸å…³æ–‡ä»¶å¤¹ï¼ŒçŒœæµ‹æ˜¯é¢„å®‰è£…çš„é—®é¢˜

ã€€ã€€æ‰€ä»¥è¿™ä¸ªå€¼æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ

ã€€ã€€â€

ã€€ã€€â€

ã€€ã€€â€

ã€€ã€€/opt/software/ openGauss/clusterconfig.xmlä¸ºopenGaussé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·éœ€æ ¹æ®æç¤ºè¾“å…¥æ•°æ®åº“ç®¡ç†å‘˜ommç”¨æˆ·çš„å¯†ç ï¼Œå¯†ç å…·æœ‰ä¸€å®šçš„å¤æ‚åº¦ï¼Œä¸ºä¿è¯ç”¨æˆ·æ­£å¸¸ä½¿ç”¨è¯¥æ•°æ®åº“ï¼Œè¯·è®°ä½è¾“å…¥çš„æ•°æ®åº“å¯†ç ã€‚

ã€€ã€€å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š

* Encodingï¼šè®¾ç½®å­—ç¬¦é›†ï¼›
* max_process_memoryï¼šè®¾ç½®ä¸€ä¸ªæ•°æ®åº“èŠ‚ç‚¹å¯ç”¨çš„æœ€å¤§ç‰©ç†å†…å­˜ï¼›
* shared_buffersï¼šè®¾ç½®openGaussä½¿ç”¨çš„å…±äº«å†…å­˜å¤§å°ï¼›
* bulk_write_ring_sizeï¼šå¤§æ‰¹é‡æ•°æ®å†™å…¥è§¦å‘æ—¶ï¼Œè¯¥æ“ä½œä½¿ç”¨çš„ç¯å½¢ç¼“å†²åŒºå¤§å°ï¼›
* cstore_buffersï¼šè®¾ç½®åˆ—å­˜æ‰€ä½¿ç”¨çš„å…±äº«ç¼“å†²åŒºçš„å¤§å°ã€‚
* æŒ‰ç…§è®¾ç½®å¯†ç è¦æ±‚ï¼Œè®¾ç½®å¯†ç ä¸ºGaussDB@123ï¼ˆ**å»ºè®®ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®å¤æ‚å¯†ç **ï¼‰

â€‹![image](assets/image-20240602142551-t594rab.png)â€‹

ã€€ã€€â€

### 3 å¯åŠ¨æ•°æ®åº“

#### 3.1 æŸ¥çœ‹æœåŠ¡çŠ¶æ€

ã€€ã€€â€‹`gs_om -t start`â€‹

ã€€ã€€å¯åŠ¨çŠ¶æ€

â€‹![image](assets/image-20240602142807-b687rum.png)â€‹

ã€€ã€€æœªå¯åŠ¨çŠ¶æ€

â€‹![image](assets/image-20240602143016-e07me0s.png)â€‹

#### 3.2 å¯åŠ¨æœåŠ¡

ã€€ã€€â€‹`gs_om -t start`â€‹ é»˜è®¤ä¸ºå¯åŠ¨çŠ¶æ€

â€‹![image](assets/image-20240602142835-f9fmyff.png)â€‹

#### 3.3 è¿›å…¥æ•°æ®åº“

ã€€ã€€â€‹`gsql -d postgres -p 26000 -r`â€‹

â€‹![image](assets/image-20240602143452-6exbk6j.png)â€‹

ã€€ã€€â€

ã€€ã€€â€

ã€€ã€€â€
